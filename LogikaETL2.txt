Attribute VB_Name = "Module2"
Sub ZakonczTydzien()
    Dim wsDash As Worksheet
    Dim wsHist As Worksheet
    Dim tbl As ListObject
    Dim newRow As ListRow
    Dim weekNum As Long, yearNum As Long
    
    Set wsDash = ThisWorkbook.Worksheets("Trening A")
    Set wsHist = ThisWorkbook.Worksheets("Historia")
    
    '--- 1. ZnajdŸ Tabelê w Historii ---
    On Error Resume Next
    Set tbl = wsHist.ListObjects(1)
    On Error GoTo 0
    
    If tbl Is Nothing Then
        MsgBox "Brak tabeli w Historii! Zaznacz nag³ówki A1:U1 w arkuszu Historia i wciœnij Ctrl+T", vbCritical
        Exit Sub
    End If

    '--- 2. Walidacja danych (DANE OGÓLNE w kolumnie M) ---
    'Sprawdzamy M5 (Numer tygodnia)
    If IsNumeric(wsDash.Range("M5").Value) And wsDash.Range("M5").Value <> "" Then
        weekNum = wsDash.Range("M5").Value
    Else
        MsgBox "B³¹d! W komórce M5 nie ma numeru tygodnia.", vbCritical
        Exit Sub
    End If
    
    'Rok z daty (B1)
    If IsDate(wsDash.Range("B1").Value) Then
        yearNum = Year(wsDash.Range("B1").Value)
    Else
        yearNum = Year(Date)
    End If
    
    '--- 3. Dodaj wiersz do tabeli ---
    Set newRow = tbl.ListRows.Add
    
    '--- 4. ZAPIS DANYCH (Nowe mapowanie: M, O, Q) ---
    With newRow
        'A i B: Rok i Tydzieñ
        .Range(1, 1).Value = yearNum
        .Range(1, 2).Value = weekNum
        
        'C-F: Statystyki Ogólne (Bierzemy z KOLUMNY M - wg Twoich instrukcji)
        .Range(1, 3).Value = wsDash.Range("M6").Value 'Objêtoœæ tygodnia
        .Range(1, 4).Value = wsDash.Range("M7").Value 'Liczba treningów
        .Range(1, 5).Value = wsDash.Range("M8").Value 'Najciê¿szy trening
        .Range(1, 6).Value = wsDash.Range("M9").Value 'Œrednia
        
        'G-M: Objêtoœæ Partii (Bierzemy z KOLUMNY O - przesuniêcie z N)
        .Range(1, 7).Value = wsDash.Range("O5").Value  'Klata
        .Range(1, 8).Value = wsDash.Range("O6").Value  'Plecy
        .Range(1, 9).Value = wsDash.Range("O7").Value  'Nogi
        .Range(1, 10).Value = wsDash.Range("O8").Value 'Barki
        .Range(1, 11).Value = wsDash.Range("O9").Value 'Biceps
        .Range(1, 12).Value = wsDash.Range("O10").Value 'Triceps
        .Range(1, 13).Value = wsDash.Range("O11").Value 'Brzuch
        
        'N-T: Serie (Bierzemy z KOLUMNY Q - przesuniêcie z P)
        .Range(1, 14).Value = wsDash.Range("Q5").Value 'Ser. Klata
        .Range(1, 15).Value = wsDash.Range("Q6").Value 'Ser. Plecy
        .Range(1, 16).Value = wsDash.Range("Q7").Value 'Ser. Nogi
        .Range(1, 17).Value = wsDash.Range("Q8").Value 'Ser. Barki
        .Range(1, 18).Value = wsDash.Range("Q9").Value 'Ser. Biceps
        .Range(1, 19).Value = wsDash.Range("Q10").Value 'Ser. Triceps
        .Range(1, 20).Value = wsDash.Range("Q11").Value 'Ser. Brzuch
        
        'U: Data
        .Range(1, 21).Value = wsDash.Range("B1").Value
    End With
    
    MsgBox "Dane zapisane poprawnie do Historii.", vbInformation
    
End Sub
